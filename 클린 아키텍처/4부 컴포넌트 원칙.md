# 4부 12장. 컴포넌트

`컴포넌트`
- 컴포넌트는 배포단위 이고 자바는 jar 파일이 컴포넌트이다.
- 잘 설계된 컴포넌트라면 반드시 독립적으로 배포 가능한, 따라서 독립적으로 개발 가능한 능력을 갖춰야 한다.

🤔
- 독립적으로 개발? MSA? 멀티모듈?
- 의존 관계 없이 독립적으로 개발할 수 있도록 해야할 것 같다.

## 컴포넌트의 간략한 역사
- 오리진 구문
    - 프로그램의 시작부에는 프로그램이 로드될 주소를 선언하는 오리진 구문이 나와야 했다.
- PDP-9 프로그램
    - PDP-9는 DEC (Digital Equipment Corporation)가 1960년대에 개발한 컴퓨터 시스템, 18비트
- *200 결정
    - PDP-9의 메모리 구조에서 100 ~ 499 주소값이 사용자영역인데 200 주소로 생성하는 것은 그 당시 개발자 관례임.
- 라이브러리 함수 접근
    - 직접 포함시켜 단일 프로그램으로 컴파일해서 사용. (높은 의존성, 사용하지 않는 함수도 포함됨.)
- 느리고 비싸고 한정적이라는 문제점 직시
- 라이브러리와 어플리케이션(컴포넌트) 분리
- 컴포넌트 .. 라이브러리 .. 컴포넌트 .. 반복 -> (외부) 단편화 발생

## 재배치성
- 해결책
    - 재배치가 가능한 라이브러리
- 플래그 삽업 : 어느 부분을 수정해야 정해진 주소에 로드 할 수 있는지 알려주는 로더 사용
- 라이브러리 함수 (외부 참조) <-> 라이브러리 (외부) 의존성이 낮아진 링킹 로더 탄생

## 링커 로더
- 1970년대 초 링킹 로더가 느려지는 상황에 직면
- 해결책 : 로드와 링크 두 단계로 분리
- 링커 : 링크가 완료된 재배치 코드를 만듦
- 로더 : 재배치된 코드를 메모리에 적재(로딩)

🤔
- 현재 개발자는 왜 이런것을 몰라도 코딩이 가능할까?
    - 자바의 경우에는 JVM에서 링커와 로더의 역할을 수행하기 떄문에 하지 않아도 되는 것.

--- 

# 4부 13장 컴포넌트 응집도

컴포넌트 응집도의 3가지 원칙
## REP : 재사용/릴리스 등가 원칙
> 재사용 단위는 릴리스 단위와 같다.
- 릴리스 번호가 필요한이유
    - 컴포넌트들이 서로 호환되는지 보증해야 하기 떄문
    - 새 릴리스 변경사항을 보고 기존 버전을 쓸지 여부를 결정한다.

🤔
버전을 올리는 기준은 릴리스 변경사항을 보고 선택한다.
하나의 기능을 쓰기 위해 버전을 올리는 것이 맞을까?
정말 꼭 써야하는 것인지 한번 더 파악하기.

## CCP : 공통 폐쇄 원칙
- 클래스의 SRP(단일 책임 원칙)과 마찬가지로 단일 컴포넌트는 변경의 이유가 여럭 개 있어서는 안된다.
- 유지보수성이 재사용성보다 더 **훨씬**중요하다.
- OCP와 밀접한 관련 C의 Closure 폐쇄와 뜻이 같음. 변경을 최소화하고 확장에는 열려있어야한다.

🤔
변경될 가능성이 있는 클래스는 모두 한 곳으로 묶을 것을 권한다.
> 가능성을 어떻게 파악할 수 있을까..?
> 그냥 변경될 이유가 공통되는 클래스들을 한 곳으로 묶으면 되지않을까?

## CRP : 공통 재사용 원칙
> 컴포넌트 사용자들을 필요하지 않는 것에 의존하게 강요하지 말라

- 개별 클래스가 단독으로 재사용되는 경우는 거의 없다.
- 다른 클래스와 상호작용하는 클래스들이 동일한 컴포넌트에 포함되어야 한다고 말한다.

## 컴포넌트 응집도에 대한 균형 다이어그램

그림 13.1 결합도 원칙들의 균형 다이어그램을 보면
다이어그램의 각 변은 반대쪽 꼭지점에 있는 원칙을 포기했을 때 감수해야 할 비용을 나타낸다.

유지보수와 재사용성에만 과도하게 집중하면 불필요한 릴리스가 너무 빈번해진다.
프로젝트 초기에는 유지보수성이 훨씬 중요하다.
일반적으로 프로젝트는 삼각형의 오른쪽에서 시작하는 편이다.
이럴 때는 재사용성만 희생하면 된다.

---

# 14장. 컴포넌트 결합

ADP : 의존성 비순환 원칙
> 컴포넌트 의존성 그래프에 순환이 있어서는 안 된다.

`숙취 증후군` : 의존하고 있던 무언가 수정되어 기존 프로그램이 영향을 받는 현상

`해결책`
### 주단위 빌드
- 장점
    - 일주일의 첫 4일 동안은 서로 상관하지 않는다.
- 단점
    - 프로젝트가 커지면 금요일 하루만에 끝마치는 것이 어려움.
        - 배포 시작일이 목요일이 되어야 함을 인지
        - 통합에 드는 시간이 늘어나며 효율이 나빠짐
### 순환 의존성 제거하기
- 장점
    - 개발환경을 릴리스 가능한 컴포넌트 단위로 분리하는 것
        - 개인별 또는 팀이 책임질 수 있는 작업 단위가 될 수 있음.
- 단점
    - 의존성 구조를 반드시 관리해야하는 어려움이 있음.

🤔
순환 의존성 제거하는 방법은 의존성 화살표를 거꾸로 따라가서 빌드 순서가 정해지게 되는데
만약 여러 컴포넌트를 빌드해야한다면 의존 관계에 있는 맨 마지막 컴포넌트는 **유휴시간**을 가지게 되는 것이 아닐까?

### 순환이 컴포넌트 의존 그래프에 미치는 영향

`순환 끊기`
- DIP(의존성 역전 원칙)를 적용하여 해결한다.
> 그림 14.3 Entities와 Authorizer 사이의 의존성을 역전시킨다. 참고
- 유저가 필요로하는 메서드를 제공하는 인터페이스 Premissions 생성
- Authorizer는 이 인터페이스를 상속 받는다.

`흐트러짐`
- 요구사항이 변경되면 컴포넌트 구조도 변경될 수 있다.
- 순환을 항상 관찰해야 하고 어떤 식으로든 끊어야한다.

### 하향식 설계

SDP : 안정된 의존성 원칙
> 안정성의 방향으로(더 안정된 쪽에) 의존하라.

- 변경이 쉽지 않은 컴포넌트가 변동이 예상되는 컴포넌트에 의존하게 만들어서는 절대로 안 된다.
- 소프트웨어의 괴팍함 ㅋㅋ
    - 만들 때는 변경하기 쉽도록 설계했지만 이 모듈에 누군가가 의존성을 매달아버리면 모듈을 변경하기 어려워진다.

`안정성`
- 동전 예시를 통해 안정적은 '쉽게 움직이지 않는'것을 이해.
- 그림 14.5 X는 안정된 컴포넌트다.
    - 3개의 컴포넌트가 X에 의존하고 있다.
    - X는 3개의 컴포넌트를 **책임진다**라고 말한다.
    - X는 어디에도 의존하지 않음으로 X가 변경되도록 만들 수 있는 영향이 없기 때문에 독립적이라고 말한다.
- 그림 14.6 Y는 상당히 불안정한 컴포넌트다.
    - Y를 의존하는 컴포넌트가 없어 Y는 책임성이 없다.
    - 외부 세 컴포넌트가 변경이 되는 경우 영향을 받기 떄문에 의존적이라고 한다.

`안정성 지표`
- `Fan-in` : 안으로 들어오는 의존성.
    - 컴포넌트 내부의 클래스에 의존하는 컴포넌트 외부 클래스 개수를 나타낸다.
- `Fan-out` : 바깥으로 나가는 의존성.
    - 컴포넌트 외부의 클래스에 의존하는 컴포넌트 내부의 클래스 개수를 나타낸다.
- `I(불안정성)` : I = Fan-out / (Fan-in + Fan-out)
    - I=0 안정성이 높다. I=1 불안정하다.
    - X는 I = 0 / (3 + 0) = 0 임. 안정성이 높다.
    - Y는 I = 3 / (0 + 3) = 1 임. 불안정하다.

### SAP : 안정된 추상화 원칙
> 컴포넌트는 안정된 정도만큼만 추상화되어야 한다.
- 시스템에서 고수준 정책을 캡슐화하는 소프트웨어는 반드시 안정된 컴포넌트(I=0)에 위치해야한다.
- 불안정한 컴포넌트(I=1)는 반드시 변동성이 큰 소프트웨어, 즉 쉽고 빠르게 변경할 수 있는 소프트웨어만을 포함해야한다.

**추상화 정도 측정하기**
- Nc : 컴포넌트의 클래스 개수
- Na : 컴포넌트의 추상 클래스와 인터페이스의 개수
- A: 추상화 정도. A = Na / Nc
> A 지표는 0과 1사이의 값을 갖는다. A가 0이면 컴포넌트에는 추상 클래스가 하나도 없다는 뜻이다.
> A가 1이면 컴포넌트는 오로지 추상 클래스만을 포함한다는 뜻이다.

**주계열**
안정성과 추상화 정도 사이의 관계를 정의

- 그림 14.12 A/I 그래프
    - (0,0) 고통의 구역
        - 구체적이고 많은 컴포넌트가 의존한다.
        - ex. 데이터베이스 스키마
    - (1,1) 쓸모없는 구역
        - 폐기물

**주계열과의 거리**
- D^4 : 거리, D = |A + I - 1|
- D가 0이면 컴포넌트가 주 계열 바로 위에 위치한다는 뜻
- D가 1이면 주계열로부터 가장 멀리 위치한다는 뜻

컴포넌트는 주계열 바로 위 또는 가깝게 위치할 때 가장 이상적이다.